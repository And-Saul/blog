{
  "hash": "0572dcacb8983b1c635c761e68376daa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R Patchwork hacks I found useful\"\nauthor: \"Andrew Saul\"\ndate: \"2025-02-17\"\ncategories: [Patchwork]\nimage: \"image.jpg\"\n---\n\n\n\n\n\n### Introduction\n\nPresented are a few hacks using Patchwork that took me some time to discover.\n\nBelow is code that creates two categorical plots, each having the same ordered x and y axis labels. The task is to create a combined plot that uses only one set of y axis labels and legend. Both plots are to share the x-axis title and image caption.\n\n#### Plot Objects\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creates a single plot depdendent on the \"cut\"  variable\nplot_func <- function(var){\n  diamonds %>% \n    filter(cut == var) %>% \n    ggplot(aes(x = clarity, y = price, fill = color))+\n    geom_col(position = \"fill\")+\n    coord_flip()+\n    labs(title = var)\n}\n\n#saves the plots to a list object\nplots <-   map(c(\"Ideal\", \"Fair\"), plot_func)\n```\n:::\n\n\n\n#### Display\n\n##### Display the two plots side by side\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplots[[1]]+plots[[2]]\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n##### Use a common legend\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplots[[1]]+plots[[2]] + plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n##### Use the same axes\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplots[[1]]+plots[[2]] + plot_layout(guides = \"collect\", axes = \"collect\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n##### Annotations\n\nUse \"plot_annotations\" function to give the patchwork plot a common annotation. Utilise the caption option in the plot_annotation function\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(plots[[1]]+plots[[2]]) + \n  plot_layout(guides = \"collect\", axes = \"collect\")+\n  plot_annotation(caption = \"This is the common caption for both plots\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n#### Change name of x-axis title\n\nIf the title of the x-axis needs to be replaced, I found the above process didn't work. Instead I removed the x-axis title from both plots with a NULL value in the plot function. At the bottom of both plots I printed the x-axis title. Please note that this centered x-axis title is below the normal level of the x-axis title. <br> The first action undertaken was to create a function where the x-axis title was converted to an empty string. Because the categories of the column geom were flipped with *coord_flip*, the x-axis features in the plots are infact y-axis features. As such the **y** labs string was given a **NULL** value.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creates a single plot depdendent on the \"cut\"  variable\nplot_func_xaxis <- function(var){\n  diamonds %>% \n    filter(cut == var) %>% \n    ggplot(aes(x = clarity, y = price, fill = color))+\n    geom_col(position = \"fill\")+\n    coord_flip()+\n    labs(title = var,\n         y=NULL)\n}\n```\n:::\n\n\n\nThe two plots were saved into a list object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_change_xaxis <-   map(c(\"Ideal\", \"Fair\"), plot_func_xaxis)\n```\n:::\n\n\n\nThe plot_layout function was invoked so that only one legend and one set of y-axis variables were displayed.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchange_xaxis_plots <- \n(plot_change_xaxis[[1]]|plot_change_xaxis[[2]])+\n  plot_layout(guides = \"collect\", axes = \"collect\")\n```\n:::\n\n\n\nFinally, in order to display a new x-axis title, the *wrap_elements* function was invoked and the tag attribute in the labs function was given the new x-axis title. By default, the tag element is displayed in the top_left corner of the plot. The plot.tag attributes invoked within the *theme* function can change the appearance of the tag string\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrap_elements(panel = change_xaxis_plots)+\n  labs(tag = \"Proportion of total price\")+\n  theme(\n    plot.tag = element_text(size = rel(1.5)),\n    plot.tag.position = \"bottom\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\nI hope the reader has found this code useful.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}